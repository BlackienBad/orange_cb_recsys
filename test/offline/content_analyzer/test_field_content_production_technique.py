from unittest import TestCase
import numpy as np
from offline.content_analyzer.combining_technique import Centroid
from offline.content_analyzer.embedding_source import BinaryFile
from offline.content_analyzer.field_content_production_technique import EmbeddingTechnique, Granularity


class TestEmbeddingTechnique(TestCase):
    def test_produce_content(self):
        technique = EmbeddingTechnique(Centroid(), BinaryFile('../../../datasets/word2vec/google_news.bin'),
                                       Granularity.DOC)

        result = technique.produce_content("title plot")

        expected = np.ndarray(shape=(300,))
        expected[:] = [0.21777344, -0.11254883, 0.02355957, -0.19287109, -0.03613281,
                       -0.12487793, -0.07397461, 0.31787109, -0.03125, 0.03686523,
                       -0.01855469, 0.04760742, -0.14892578, -0.00561523, -0.05554199,
                       0.14355469, 0.13233948, 0.23486328, 0.11328125, -0.08435059,
                       -0.046875, 0.17138672, 0.13879395, 0.01992798, 0.12817383,
                       -0.22021484, -0.08435059, 0.08129883, -0.04174805, 0.00598145,
                       -0.0848999, 0.03051758, 0.15869141, -0.11881256, -0.06152344,
                       0.30371094, 0.05517578, -0.03295898, 0.1053772, 0.15020752,
                       0.15332031, -0.0604248, 0.00805664, 0.20910645, -0.12536621,
                       -0.25830078, 0.1192627, 0.00708008, 0.12329102, -0.07250977,
                       -0.02648926, 0.13452148, 0.04553223, 0.05444336, -0.02832031,
                       -0.18994141, 0.05950928, -0.23071289, 0.06079102, -0.14038086,
                       0.11068726, 0.21166992, 0.06420898, 0.03430176, -0.27368164,
                       0.08398438, 0.07411194, -0.02069092, 0.22851562, -0.01733398,
                       0.02099609, -0.14697266, -0.0447998, -0.06396484, -0.32177734,
                       -0.06298828, -0.02478027, -0.09155273, 0.09619141, -0.06445312,
                       0.10656738, -0.03710938, 0.04455566, 0.02294922, -0.16748047,
                       -0.17602539, -0.08300781, 0.10913086, 0.21044922, 0.14453125,
                       0.06347656, -0.05899048, -0.20996094, -0.16485596, -0.05883789,
                       -0.06665039, -0.13330078, -0.29736328, -0.19873047, 0.11987305,
                       -0.17590332, 0.09838867, 0.2052002, -0.02261353, 0.04058838,
                       0.13476562, -0.24560547, -0.01871109, 0.02587891, 0.13128662,
                       -0.02062988, 0.1248703, 0.06542969, 0.13061523, 0.02896118,
                       -0.06591797, 0.14068604, 0.1121521, 0.13684082, -0.03027344,
                       -0.15039062, -0.07104492, 0.16015625, -0.06280518, -0.00085449,
                       0.04602051, -0.09350586, -0.22338867, -0.24121094, 0.11743164,
                       0.02729797, -0.10473633, 0.05603027, 0.03938293, 0.11132812,
                       0.17138672, 0.00952148, 0.05551147, -0.19384766, 0.1262207,
                       0.05883789, -0.32324219, 0.04980469, -0.1315918, -0.03515625,
                       0.09753418, -0.09301758, 0.14550781, -0.30078125, 0.09069824,
                       -0.07122803, 0.02392578, 0.18115234, -0.03973389, 0.06616211,
                       -0.29638672, -0.05310059, -0.01428223, 0.04711914, -0.05529785,
                       0.17260742, -0.00756836, 0.24316406, 0.02954102, -0.26708984,
                       0.00048828, 0.28466797, -0.15185547, -0.06835938, 0.19552612,
                       0.0769043, -0.15917969, -0.06298828, -0.17138672, -0.08032227,
                       -0.01513672, -0.05322266, -0.38769531, -0.06616211, -0.05273438,
                       -0.15966797, -0.10961914, -0.19604492, -0.20166016, -0.01611328,
                       0.015625, 0.08679199, 0.16455078, 0.18408203, 0.07995605,
                       0.21044922, -0.05126953, 0.03393555, 0.02099609, -0.07177734,
                       0.07446289, -0.12353516, 0.04785156, -0.02661133, 0.0032959,
                       -0.03955078, -0.05957031, -0.13415527, 0.17773438, 0.04882812,
                       -0.10180664, -0.00610352, 0.04296875, 0.03051758, -0.10162354,
                       0.08300781, 0.01544189, 0.08398438, -0.08239746, -0.18212891,
                       0.13439941, 0.03710938, -0.12438965, -0.04656982, -0.13235474,
                       -0.03393555, 0.14038086, 0.22729492, 0.19140625, 0.05102539,
                       -0.00439453, -0.25488281, -0.09326172, 0.0012207, 0.00878906,
                       0.00634766, -0.14013672, -0.22184753, 0.04736328, 0.0814209,
                       0.00830078, 0.14343262, 0.04736328, 0.25390625, -0.12817383,
                       -0.03979492, -0.11450195, 0.10803223, -0.18945312, -0.06272888,
                       0.04833984, 0.12231445, -0.09033203, -0.11743164, -0.04882812,
                       -0.08654785, 0.11816406, -0.01416016, 0.0546875, -0.10449219,
                       0.12695312, -0.11315918, -0.15966797, -0.24707031, -0.04785156,
                       -0.0471344, 0.05444336, -0.27770996, -0.0690918, 0.18480682,
                       0.31054688, -0.22241211, -0.01220703, -0.14556885, -0.12744141,
                       -0.03271484, 0.02552795, 0.09509277, 0.0715332, 0.00158691,
                       -0.01611328, -0.00048828, -0.00366211, -0.02716064, 0.16113281,
                       0.0065918, -0.17333984, -0.01367188, 0.01731873, -0.0435791,
                       -0.16375732, -0.24267578, 0.06982422, -0.18066406, -0.17407227,
                       -0.31152344, 0.06285095, -0.03625488, -0.13638306, -0.15783691,
                       0.04512024, -0.08581543, -0.29638672, -0.02893066, 0.03107452]

        self.assertTrue(np.array_equal(result, expected))
